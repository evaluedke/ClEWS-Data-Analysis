---
title: "Data Analysis Final Report"
author: "Eva Lüdke (820679) & Franziska Schwab (816512) "
date: "2023-03-31"
output:
  html_document:
    theme: cosmo
    toc: yes
    toc_float: true
  html_notebook: 
    theme: journal
    toc: true
    toc_float: true
  pdf_document:
    keep_tex: yes
    latex_engine: xelatex
fontsize: 12 pt
---

### Summary (5 points)

-   a short five-sentence abstract of your project

### Objectives (10 points)  n

The objectives of the project are to analyse the relationship between meteorological and renewable energy variables such as the wind speed and energy generated by wind. In addition, a comparison of selected European countries in terms of climate and energy variables should be provided. This analysis might give an indication of the potential in the expansion of renewable energies such as in what area it would be particularly useful to scale up the production.

In the first method, which is a linear regression, the relationship between solar power generation and direct solar energy as well as hydro power generation and the total precipitation are examined. This is done by using a simple regression with a single predictor, and a multivariate regression with two predictors for specifically selected countries.

-Method 2

The third method aims to test for statistically significant differences between the direct energy from the sun for selected countries and the solar power generation for the same countries. By performing an ANOVA test for both variables, it is analysed how they differ from each other in those countries.

-Method 4 +1

### Data description and general referencing (5 points)

This dataset describes the climate and renewable energy indicators for 38 European countries from 1979 to present. The parameters include climate variables and indicators from the energy sector which are:

-   Electricity demand (EDM [MWh])

    -   consumption of electricity

-   Solar photovoltaic power generation (SPV [MW/MW])

-   Surface downwelling shortwave radiation (GHI [Wm-2])

    -   direct energy from the sun as the sum of all wavelengths (Schmid (2022))

-   Hydro power generation from reservoirs (HRE [W])

-   Hydro power generation from run-of-river (HRO [W])

    -   Hydroelectric generation without a reservoir or water storage

-   2m Air temperature (TA [K])

-   Pressure at sea level (MSL [Pa])

-   Total precipitation (TP [K])

-   Wind power generation onshore (WON [MW/MW])

-   Wind speed at 100m (WS-10m [ms-1])

-   Wind speed at 10m (WS-100m [ms-1])

The meteorological variables are derived from the ERA5 climate reanalysis. Reanalysis is a process that combines historical observation data with models to obtain a complete time series of those climate variables. ERA5 is a climate reanalysis project of the European Centre for Medium-Range Weather Forecasts (ECMWF) together with the Copernicus climate change service (C3S). The energy data comes from several sources, inter alia, the European Network of Transmussion System Operators (ENTSO-E) (Climate Data Store, 2023; ECMWF, 2023). The dataset is sourced from the Copernicus climate change service (C3S) (DOI: 10.24381/cds.4bd77450). It has a temporal resolution of one year and produces a mean value for each country per year. It was subdivided into each parameter, which had to be combined beforehand.

```{r echo=FALSE,message=FALSE, warning=FALSE}
library(tidyverse)
library(tidymodels)
library(ggplot2)
library(dplyr)
library(tibble)
library(foreach)
library(GGally)
library(egg)

```

```{r echo=FALSE,message=FALSE, warning=FALSE}
knitr::opts_chunk$set(root.dir = "C:/Users/User/OneDrive/Dokumente/ClEWS-Data-Analysis")
```

```{r echo=FALSE,message=FALSE, warning=FALSE}
setwd("C:/Users/User/OneDrive/Dokumente/ClEWS-Data-Analysis")
```

### Preprocessing Data

```{r}
#Load each parameter 
#electricity demand in MWh (EDM [MWh])
electricity_demand_his <- read.csv("dataen/electricitydemand.csv")

#global horizontal irradiance in W m-2
irradiance_his <- read.csv("dataen/globalhoritontalirradiance.csv")

#hydropower reservoir (HRE) in W
hydropower_reservoir_his <- read.csv("dataen/hydropowerreservoir.csv")

#hydropower run-of-river (HRO) in W
hydropower_ro_his <- read.csv("dataen/hydropowerror.csv")

#mean sea level pressure in Pa
sealevelpressure_his <- read.csv("dataen/sealevelpressure.csv")

#solar pv power in MW/MW
solarpvpwr <- read.csv("dataen/solarpvpwr.csv")

#air temperature in K
air_temperature_his <- read.csv("dataen/airtemperature.csv")

#total precipitation in m
total_pr_his <- read.csv("dataen/totalpr.csv")

#wind power onshore in MW/MW
windpoweronshore_his <- read.csv("dataen/windpoweronshore.csv")

#wind speed in 10 m in m s-1
wind_speed_10_his <- read.csv("dataen/windspeed10.csv")

#wind speed in 100 m in ms-1
wind_speed_100_his <- read.csv("dataen/windspeed100.csv") 

```

```{r}
#insert missing columns for electricity_demand
electricity_demand <- electricity_demand_his

electricity_demand <- electricity_demand %>% add_column(AL=0, .after = "Date") %>% add_column(IS=0, .after="IE") %>% add_column(LI=0, .after = "IT") %>% add_column(MT=0, .after="MK") %>% add_column(TR=0, .after="SK")

```

```{r}

#add all variables into one dataframe

#countries <- c("AL","AT","BA","BE","BG","CH","CY","CZ","DE","DK","EE","EL","ES","FI","FR","HR","HU","IE","IS","IT","LI","LT","LU","LV","ME","MK","MT","NL","NO","PL","PT","RO","RS","SE","SI","SK","TR","UK")

#numbers <- c(2:39)

#for (i in seq_along(numbers)) {
  
#  print(paste(numbers[i],countries[i]))
#}

#select one Country from each dataframe
#`EDM [MWh]` <- electricity_demand %>% dplyr::select(1,39) 
#colnames(`EDM [MWh]`)[2] <- "EDM [MWh]"

#`GHI [Wm-2]` <- irradiance_his %>% dplyr::select(1,39)
#colnames(`GHI [Wm-2]`)[2] <- "GHI [Wm-2]"

#`HRE [W]` <- hydropower_reservoir_his %>% dplyr::select(1,39)
#colnames(`HRE [W]`)[2] <- "HRE [W]"

#`HRO [W]` <- hydropower_ro_his %>% dplyr::select(1,39)
#colnames(`HRO [W]`)[2] <- "HRO [W]"

#`MSL [Pa]` <- sealevelpressure_his %>% dplyr::select(1,39)
#colnames(`MSL [Pa]`)[2] <- "MSL [Pa]"

#`SPV [MW/MW]` <- solarpvpwr %>% dplyr::select(1,39)
#colnames(`SPV [MW/MW]`)[2] <- "SPV [MW/MW]"

#`TA [K]` <- air_temperature_his %>% dplyr::select(1,39)
#colnames(`TA [K]`)[2] <- "TA [K]"

#`TP [m]` <- total_pr_his%>% dplyr::select(1,39)
#colnames(`TP [m]`)[2] <- "TP [m]"

#`WON [MW/MW]` <- windpoweronshore_his %>% dplyr::select(1,39)
#colnames(`WON [MW/MW]`)[2] <- "WON [MW/MW]"

#`WS-10m [ms-1]` <- wind_speed_10_his %>% dplyr::select(1,39)
#colnames(`WS-10m [ms-1]`)[2] <- "WS-10m [ms-1]"

#`WS-100m [ms-1]` <- wind_speed_100_his %>% dplyr::select(1,39)
#colnames(`WS-100m [ms-1]`)[2] <- "WS-100m [ms-1]"

#merge dataframes together by Date

#countries[i] <- Reduce(function(x,y) merge(x,y, all=TRUE), list(`EDM [MWh]`,`GHI [Wm-2]`,`HRE [W]`,`HRO [W]`,`MSL [Pa]`,`SPV [MW/MW]`,`TA [K]`,`TP [m]`,`WON [MW/MW]` ,`WS-10m [ms-1]`,`WS-100m [ms-1]`))

#add class "Country"
#countries[i]$Country <- countries[i]


#bind dataframes together 

#newenergydata <- bind_rows(AL,AT,BA,BE,BG,CH,CY,CZ,DE,DK,EE,EL,ES,FI,FR,HR,HU,IE,IS,IT,LI,LT,LU,LV,ME,MK,MT,NL,NO,PL,PT,RO,RS,SE,SI,SK,TR,UK)

#this did not work which is why the data was combined manually into the file newenergydata.csv 
```

```{r}
newenergydata <-read.csv("newenergydata.csv",check.names=FALSE)
```

```{r}
#creating a subset for Germany 
Germany <- subset(newenergydata, Country == "DE") 
summary(Germany)
```

```{r}
Germany$Date <- NULL
ggpairs(Germany,diag = list(continuous="barDiag"))+
  theme(text = element_text(size = 6),panel.spacing = unit(0.1, "lines"))
```

### Methods 1: Applications of the linear model (20 points)

#### 1st Application

To analyze how the solar photovoltaic power generation depends on the irradiance and is distributed in Europe, three exemplary Countries are chosen for visualization: Germany, since it has the highest solar power generation, Norway and Spain, since they have lower and higher values of global horizontal irradiance, respectively.

```{r}
#Create General Linear Model for Irradiance and Solar photovoltaic power generation in Germany
mod <- glm(`SPV [MW/MW]`~ `GHI [Wm-2]` , data=Germany)

intercept <- formatC(coef(mod)[1], format = "e", digits = 2)
slope <- formatC(coef(mod)[2], format = "e", digits = 2)

label1 <- paste0("y = ",slope," x + ",intercept)

```

```{r}
#plot irradiance solar power  
germanyplot = ggplot(Germany,aes(x = `GHI [Wm-2]`, 
                 y= `SPV [MW/MW]`,
                 col=Country)) +
  geom_point(alpha = 0.8,col="darkorchid")+
  geom_smooth(method = "glm", 
              formula = y ~ x, 
              aes(col = "Germany"),
              fill="darkorchid") +
  scale_colour_manual(name="Country", values="darkorchid")+
  annotate("text", x = 124, y = 49161000, label = label1, col = "darkorchid",size = 8/.pt)+
  labs(y = "Solar photovoltaic power generation [MW/MW]", x = "Surface downwelling shortwave radiation [Wm-2]") + 
  theme_bw()+
  theme(axis.text.y = element_text(angle=90, vjust=.5, hjust=1),legend.position = "top")

```

```{r}

#Create General Linear Model for Irradiance and Solar photovoltaic power generation in Norway
modNO <- glm(`SPV [MW/MW]`~ `GHI [Wm-2]` , data=newenergydata %>% filter(Country == "NO"))

intercept <- formatC(coef(modNO)[1], format = "e", digits = 2)
slope <- formatC(coef(modNO)[2], format = "e", digits = 2)

label2 <- paste0("y = ",slope," x + ",intercept)

#irradiance solar power Norway
norwayplot = ggplot(newenergydata %>% filter(Country == "NO"),aes(x = `GHI [Wm-2]`, 
                 y= `SPV [MW/MW]`,
                 col="")) +
  geom_point(alpha = 0.8,col="blue")+
  geom_smooth(method = "glm", 
              formula = y ~ x, 
              aes(col = "Norway"),
              fill="blue") +
  scale_colour_manual(name="", values="blue")+
  annotate("text", x = 94, y = 580000 , label = label2, col = "blue",size = 8/.pt)+
  labs(y = "Solar photovoltaic power generation [MW/MW]", x = "Surface downwelling shortwave radiation [Wm-2]") + 
  #ylim(500000,50000000)+
  theme_bw()+
  theme(axis.text.y = element_text(angle=90, vjust=.5, hjust=1),legend.position = "top")

```

```{r}
#Create General Linear Model for Irradiance and Solar photovoltaic power generation in Spain
modES <- glm(`SPV [MW/MW]`~ `GHI [Wm-2]` , data=newenergydata %>% filter(Country =="ES"))

intercept <- formatC(coef(modES)[1], format = "e", digits = 2)
slope <- formatC(coef(modES)[2], format = "e", digits = 2)

label3 <- paste0("y = ",slope," x + ",intercept)

#irradiance solar power Spain
spainplot = ggplot(newenergydata %>% filter(Country =="ES"),aes(x = `GHI [Wm-2]`, 
                 y= `SPV [MW/MW]`,
                 col="")) +
  geom_point(alpha = 0.8,col="hotpink")+
  geom_smooth(method = "glm", 
              formula = y ~ x, 
              aes(col = "Spain"),
              fill="hotpink") +
  scale_colour_manual(name="", values="hotpink")+
  annotate("text", x = 191, y = 7010000 , label = label3, col = "hotpink",size = 8/.pt)+
  labs(y = "Solar photovoltaic power generation [MW/MW]", x = "Surface downwelling shortwave radiation [Wm-2]") + 
  #ylim(500000,50000000)+
  theme_bw()+
  theme(axis.text.y = element_text(angle=90, vjust=.5, hjust=1),legend.position = "top")

```

```{r}
ggarrange(germanyplot+
              theme(axis.ticks.x = element_blank(),
                  axis.title.x = element_blank()),
          norwayplot+
              theme(axis.ticks.y = element_blank(),
                    axis.title.y = element_blank()),
          spainplot+
            theme(axis.ticks.x = element_blank(),
                  axis.title.x = element_blank(), 
                  axis.ticks.y = element_blank(),
                  axis.title.y = element_blank() ),
          nrow=1)
```

This figure shows that there is a linear relationship between the surface downwelling shortwave radiation and the solar power generation by photovoltaic technology. Germany generally has the highest solar photovoltaic power generation that ranges from 3.87*10\^7 to 4.80* 10\^7 MW/MW. Norway appears to have lower irradiance and much lower values of power generation by solar power. Spain exhibits higher surface downwelling shortwave radiation and higher solar power generation than Norway, but less power generated from solar photovoltaic than Germany. The linear equations obtained by the general linear models indicate that the linear relationship of Germany has the highest slope of 2.66\*10\^5, which means that the power generation increases by that value when the irradiance increases by 1 Wm\^-2. Even though the surface downwelling radiation in Spain is higher as in Germany, the solar power generation is lower, which implies that the solar power generation does not only depend on the direct energy from the sun. It can be assumed that Germany has more solar photovoltaic panels installed than Spain that add to the energy generation. This may lead to the conclusion that the potential for solar power generation in Spain is much larger. When making use of the high irradiance, Spain could potentially generate more solar photovoltaic power than Germany.

#### 2nd Application:

In the second application, the hydropower generation from run-of-river power plants is analyzed using France as an example since they generate the most power in Europe with this technology. A linear model investigates whether there is a linear relationship between annual total precipitation and hydropower generation, as well as the mean sea level pressure.

```{r}
modHRO <- glm(`HRO [W]`~`TP [m]`,data=newenergydata %>% filter(Country == "FR"))
labelHRO <- paste0("y = ",formatC(coef(modHRO)[2], format = "e", digits = 2),
                    " x + ",formatC(coef(modHRO)[1], format = "e", digits = 2))

#precipitation hydropower runoff   

ggplot(newenergydata %>% filter(Country == "FR"), 
       aes(x = `TP [m]`, 
           y= `HRO [W]`)) +
  geom_point(alpha = 0.8,color="turquoise")+
  labs(x = "Total precipitation [m]", y = "Hydropower run-of-river [W]") + 
  theme_bw()+
  geom_smooth(method = "glm", 
              formula = y ~ x,
              aes(col="France"),
              fill="turquoise")+
  scale_colour_manual(name="", values="turquoise")+
  annotate("text", x = 0.81, y = 50000000, label = labelHRO, col = "turquoise")
```

```{r}
France <- newenergydata %>% filter(Country == "FR")
cor(France$`HRO [W]`,France$`TP [m]`)
```

The figure shows that there is a positive linear relationship between total precipitation and run-of-river hydropower in France. Increasing the precipitation by 1 m leads to 2.89\*10\^7 W more generated power. There is a correlation coefficient has a value of \~ 0.52 which can be interpreted as a strong positive correlation.

```{r}
#mean sea level pressure hydropower runoff   
modMSL <- glm(`HRO [W]`~ `MSL [Pa]`,data=newenergydata %>% filter(Country == "FR"))
labelMSL <- paste0("y = ",formatC(coef(modMSL)[2], format = "e", digits = 2),
                    " x + ",formatC(coef(modMSL)[1], format = "e", digits = 2))
  

ggplot(newenergydata %>% filter(Country == "FR"), 
       aes(x = `TP [m]`, 
           y= `MSL [Pa]`,
           col=Country)) +
  geom_point(alpha = 0.8,color="turquoise")+
  labs(x = "Mean sea level pressure [Pa]", y = "Hydropower run-of-river [W]") + 
  theme_bw()+
  geom_smooth(method = "glm", 
              formula = y ~ x,
              aes(col="France"),
              fill="turquoise")+
  scale_colour_manual(name="", values="turquoise")+
  annotate("text", x = 0.81, y = 101910, label = labelMSL, col = "turquoise")
```

Here, the relationship between Mean sea level pressure and hydropower is presented. The regression line indicates that there is a negative correlation between both variables. Increasing the sea level pressure by 1 Pa, decreases the hydropower generation by 1.15\*10\^4 W. However, the plot shows that more data points compared to the previous plot are located beyond the standard errors of the regression line. The Pearson Correlation Coefficient has a value of \~ -0.199, which can be interpreted as a weak negative correlation

```{r}
France <- newenergydata %>% filter(Country == "FR")
cor(France$`HRO [W]`,France$`MSL [Pa]`)
```

```{r}
cor(France$`MSL [Pa]`,France$`TP [m]`)
```

However, the mean sea level pressure and the total precipitation have a strong negative correlation (correlaiton coefficient \~-0.55). Therefore, they can be treated as multiplicative predictors in a multivariate regression model.To compare the goodness-of-fit of the different models, the Akaike's Information Criterion (AIC) is a determined. The following table depicts the AIC scores of the model that includes the hydropower generation and the precipitation (modHRO), the model with hydropower generation and mean sea level pressure (modMSL), and the multivariate model.The latter has the lowest AIC score which indicates that this is the preferable model.

```{r}
modMV <- glm(`HRO [W]` ~ `TP [m]`*`MSL [Pa]`  , data = France)

AIC(modHRO,modMSL,modMV)
```

```{r}
#ggplot(newenergydata %>% filter(Country == "FR"), 
#       aes(x = `TP [m]`, 
#           y= `HRO [W]`)) +
#  geom_point(alpha = 0.8,color="turquoise")+
#  labs(x = "Total precipitation [m]", y = "Hydropower run-of-river [W]") + 
#  theme_bw()+
#  geom_abline(intercept = coef(modMV)[1],
#              slope = coef(modMV)[2], col = "turquoise") +
#  scale_colour_manual(name="", values="turquoise")

```

### Methods 2: Applications of tree-based models (20 points)

### Methods 3: Application of statistical testing (10 points)

In this method, a statistical test is applied to investigate the statistical significant differences in the data between the countries for selected variables. Here, the focus is on the global horizontal irradiance and the solar photovoltaic power as in Task 1. Using an ANOVA, the statistical differences between the 10 largest countries are determined for both variables. In the following figures, the variables are visualized through boxplots.

```{r}
colorpalette <- c("darkorchid","hotpink","orchid","turquoise","lightblue","blue","darkgreen","darkseagreen","darkseagreen2","darkseagreen1")

substat <- newenergydata %>% filter(Country == "DE" |
                      Country == "FR"|
                      Country == "NO"|
                      Country == "ES"|
                      Country == "UK"|
                      Country == "RO"|
                      Country == "SE"|
                      Country == "FI"|
                      Country == "PL"|
                      Country == "IT"|
                      Country == "GR"
                      )
ggplot(substat, aes(x = Country, y =`GHI [Wm-2]`, fill =Country)) +
  geom_boxplot() +
  labs(y = "GHI [Wm-2]", ) +
  geom_jitter(position=position_jitter(0.1), alpha =0.3)+
  theme_bw()+
  scale_fill_manual(values=colorpalette)
```

This figure shows that Spain has the highest irradiance.

```{r}
ggplot(substat, aes(x = Country, y =`SPV [MW/MW]`, fill =Country)) +
  geom_boxplot() +
  labs(y = "SPV [MW/MW]", ) +
  geom_jitter(position=position_jitter(0.1), alpha =0.3)+
  theme_bw()+
  scale_fill_manual(values=colorpalette)

```

This figure shows that the solar power generation in Germany is much higher compared to all other countries.

In the following, an ANOVA Test is conducted with the 10 countries, analysing if there is a statistical difference between the means of the irradiance for each country. The null hypothesis states that the means of all groups is equal.

```{r}
#ANOVA GHI
modghi <- aov(`GHI [Wm-2]` ~ `Country`,
                       data = substat)

summary(modghi)
```

This summary gives the result of the ANOVA. The "Pr(\>F)" presents the p-value, which is needed to reject the null hypothesis. Since it is smaller than 2\*10\^-16 and therefore smaller than 0.05, the commonly used significance level, it can be concluded that the means of the irradiance are significantly different between the countries.

Another ANOVA Test is conducted with the 10 countries, analysing if there is a statistical significant difference between the means of the solar power generation for each country. The null hypothesis states that the means of all groups is equal.

```{r}
#ANOVA GHI
modspv <- aov(`SPV [MW/MW]` ~ `Country`,
                       data = substat)

summary(modspv)
```

Again, the summary presents a p-value smaller than 2\*10\^-16 which concludes that there is a statistical significant difference between the means of the solar power generation for each country and the null hypothesis can be rejected.

Other test: see if there is a positive development over time of any renewable energy?

### Methods 4: Application of XXX (15 points)

### Discussion and Conclusions (15 points)

-   *What did you learn from your data analysis?*

-   *How could this be improved?*

-   *etc.*

-   Allgemein

    -   This project illustrated how challenging it is working with large data sets since there are many options for what aspects to visualize and what statistical analyses to perform. There are numerous elements which the data set could represent. Furthermore, it showed that a targeted use of statistical tests and analyses is essential in order to achieve valuable results. Defining a research question at the beginning of the project can help to work target-oriented and focused.

    -   It became apparent how enhanced coding skills significantly facilitate the analysis. For example, being able to write loops leads to faster results and a more efficient work flow. While there is still room for improvement, this data analysis helped in that matter by solving problems we ran into.

-   inhaltlich

    -   Seeing the European comparison of the absolute generation of renewable power was interesting and was well demonstrated by the visualizations. It became clear how the renewable power generation depends on the meteorological conditions, which are often linear relationships. However, it also showed that the climatic requirements are not the only factors that influence the generation of wind-, solar-, and hydropower as seen i.e. in the comparison of Germany's and Spain's solar power generation. From that we can conclude that policy and infrastructure are strongly influencing the generation of renewable power. It illustrates clearly that based on the climatic conditions, there is much more potential for the generation of renewable energy to increase.

    -   However, the data set only includes the absolute values of generated energy. The analysis could be improved by putting the produced energy into context, e.g. by including the percentage of how much of the total energy production came from solar-, wind-, and hydroenergy. That would make it possible to better compare smaller or lower populated countries with countries larger in area and population, respectively. Because when looking at the generation of solar power for example, it appears that Germany has the highest absolute solar power generation. However when looking at the percentage share of electricity generation through solar power, several European Countries, including e.g. Spain, show higher values than Germany (Ember, 2023)

    -   Would be interesting to include nuclear and fossil energy generation per country

    -   Additionally, it would be useful to have a higher resolution in time to see how the climate variables and with that the energy generation vary over the course of a year

    -   Even though it seems that they produce a lot, it is not enough to reach the 1.5°C goal, much more effort needed

    -   Working and visualizing data like this is important for understanding the transition to renewable energy. Looking at data like this is important for understanding energy transition which is an important issue nowadays which needs to be tackled, to achieve climate targets such as the Paris Agreement, which is essential to ensure pleasant living conditions for upcoming generations. In light of the energy crisis in Europe it is especially important to achieve energy security and independance from other countries which cannot be secured with the use of fossil energy sources.

### References

Climate Data Store (2023). Climate and energy indicators for Europe from 1979 to present derived from reanalysis. <https://cds.climate.copernicus.eu/cdsapp#!/dataset/10.24381/cds.4bd77450?tab=overview> , accessed March 25, 2023.

Ember

European Centre for Medium-Range Weather (2023). Climate reanalysis. <https://www.ecmwf.int/en/research/climate-reanalysis> , accessed March 25, 2023.

Schmid, M., & Read, J.. (2022). Heat Budget of Lakes (pp. 467--473). <https://doi.org/10.1016/b978-0-12-819166-8.00011-6>
