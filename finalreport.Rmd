---
title: "Data Analysis Final Report"
author: "Eva LÃ¼dke (820679) & Franziska Schwab (816512) "
date: "2023-03-31"
output:
  html_document:
    theme: cosmo
    toc: yes
    toc_float: true
  html_notebook: 
    theme: journal
    toc: true
    toc_float: true
  pdf_document:
    keep_tex: yes
    latex_engine: xelatex
fontsize: 12 pt
---

### Summary (5 points)

-   a short five-sentence abstract of your project

### Objectives (10 points)

-   What do you wish to analyse and why?

### Data description and general referencing (5 points)

This dataset describes the climate and energy indicators for Europe from 1979 to present derived from reanalysis and is sourced from the Copernicus climate change service (C3S) (DOI: 10.24381/cds.4bd77450): The parameters include climate variables and indicators from the energy sector which are:

-   Electricity demand (EDM [MWh])

-   Solar photovoltaic power generation (SPV [MW/MW])

-   Surface downwelling shortwave radiation (GHI [Wm-2])

    -   ("Downwelling shortwave radiation quantifies the direct energy from the sun as the sum of all wavelengths [...] Schmid, M., & Read, J.. (2022). Heat Budget of Lakes (pp. 467--473). <https://doi.org/10.1016/b978-0-12-819166-8.00011-6> )

-   Hydro power generation from reservoirs (HRE [W])

-   Hydro power generation from run-of-river (HRO [W])

-   2m Air temperature (TA [K])

-   Pressure at sea level (MSL [Pa])

-   Total precipitation (TP [K])

-   Wind power generation onshore (WON [MW/MW])

-   Wind speed at 100m (WS-10m [ms-1])

-   Wind speed at 10m (WS-100m [ms-1])

The dataset was subdivided into each parameter. Those had to be combined beforehand. Here, we chose a subset of the Europe Data, focusing only on the countries Germany and it's neighbouring countries Switzerland, and Denmark.

We wanted to analyze whether there is a visible difference between windspeed and onshore windpower generation between these countries. Therefore if the differences are sufficient that each country is classified into one cluster. Using the *K-means clustering* algorithm, the clusters are computed and data points assigned to each cluster.

```{r echo=FALSE,message=FALSE, warning=FALSE}
library(tidyverse)
library(tidymodels)
library(ggplot2)
library(dplyr)
library(tibble)
library(foreach)
library(GGally)
library(egg)

```

```{r echo=FALSE,message=FALSE, warning=FALSE}
knitr::opts_chunk$set(root.dir = "C:/Users/User/OneDrive/Dokumente/ClEWS-Data-Analysis")
```

```{r echo=FALSE,message=FALSE, warning=FALSE}
setwd("C:/Users/User/OneDrive/Dokumente/ClEWS-Data-Analysis")
```

### Preprocessing Data

```{r}
#Load each parameter 
#electricity demand in MWh (EDM [MWh])
electricity_demand_his <- read.csv("dataen/electricitydemand.csv")

#global horizontal irradiance in W m-2
irradiance_his <- read.csv("dataen/globalhoritontalirradiance.csv")

#hydropower reservoir (HRE) in W
hydropower_reservoir_his <- read.csv("dataen/hydropowerreservoir.csv")

#hydropower run-of-river (HRO) in W
hydropower_ro_his <- read.csv("dataen/hydropowerror.csv")

#mean sea level pressure in Pa
sealevelpressure_his <- read.csv("dataen/sealevelpressure.csv")

#solar pv power in MW/MW
solarpvpwr <- read.csv("dataen/solarpvpwr.csv")

#air temperature in K
air_temperature_his <- read.csv("dataen/airtemperature.csv")

#total precipitation in m
total_pr_his <- read.csv("dataen/totalpr.csv")

#wind power onshore in MW/MW
windpoweronshore_his <- read.csv("dataen/windpoweronshore.csv")

#wind speed in 10 m in m s-1
wind_speed_10_his <- read.csv("dataen/windspeed10.csv")

#wind speed in 100 m in ms-1
wind_speed_100_his <- read.csv("dataen/windspeed100.csv") 

```

```{r}
#insert missing columns for electricity_demand
electricity_demand <- electricity_demand_his

electricity_demand <- electricity_demand %>% add_column(AL=0, .after = "Date") %>% add_column(IS=0, .after="IE") %>% add_column(LI=0, .after = "IT") %>% add_column(MT=0, .after="MK") %>% add_column(TR=0, .after="SK")

```

```{r}

#add all variables into one dataframe

#countries <- c("AL","AT","BA","BE","BG","CH","CY","CZ","DE","DK","EE","EL","ES","FI","FR","HR","HU","IE","IS","IT","LI","LT","LU","LV","ME","MK","MT","NL","NO","PL","PT","RO","RS","SE","SI","SK","TR","UK")

#numbers <- c(2:39)

#for (i in seq_along(numbers)) {
  
#  print(paste(numbers[i],countries[i]))
#}

#select one Country from each dataframe
#`EDM [MWh]` <- electricity_demand %>% dplyr::select(1,39) 
#colnames(`EDM [MWh]`)[2] <- "EDM [MWh]"

#`GHI [Wm-2]` <- irradiance_his %>% dplyr::select(1,39)
#colnames(`GHI [Wm-2]`)[2] <- "GHI [Wm-2]"

#`HRE [W]` <- hydropower_reservoir_his %>% dplyr::select(1,39)
#colnames(`HRE [W]`)[2] <- "HRE [W]"

#`HRO [W]` <- hydropower_ro_his %>% dplyr::select(1,39)
#colnames(`HRO [W]`)[2] <- "HRO [W]"

#`MSL [Pa]` <- sealevelpressure_his %>% dplyr::select(1,39)
#colnames(`MSL [Pa]`)[2] <- "MSL [Pa]"

#`SPV [MW/MW]` <- solarpvpwr %>% dplyr::select(1,39)
#colnames(`SPV [MW/MW]`)[2] <- "SPV [MW/MW]"

#`TA [K]` <- air_temperature_his %>% dplyr::select(1,39)
#colnames(`TA [K]`)[2] <- "TA [K]"

#`TP [m]` <- total_pr_his%>% dplyr::select(1,39)
#colnames(`TP [m]`)[2] <- "TP [m]"

#`WON [MW/MW]` <- windpoweronshore_his %>% dplyr::select(1,39)
#colnames(`WON [MW/MW]`)[2] <- "WON [MW/MW]"

#`WS-10m [ms-1]` <- wind_speed_10_his %>% dplyr::select(1,39)
#colnames(`WS-10m [ms-1]`)[2] <- "WS-10m [ms-1]"

#`WS-100m [ms-1]` <- wind_speed_100_his %>% dplyr::select(1,39)
#colnames(`WS-100m [ms-1]`)[2] <- "WS-100m [ms-1]"

#merge dataframes together by Date

#UK <- Reduce(function(x,y) merge(x,y, all=TRUE), list(`EDM [MWh]`,`GHI [Wm-2]`,`HRE [W]`,`HRO [W]`,`MSL [Pa]`,`SPV [MW/MW]`,`TA [K]`,`TP [m]`,`WON [MW/MW]` ,`WS-10m [ms-1]`,`WS-100m [ms-1]`))

#add class "Country"
#UK$Country <- "UK"


#bind dataframes together 

#newenergydata <- bind_rows(AL,AT,BA,BE,BG,CH,CY,CZ,DE,DK,EE,EL,ES,FI,FR,HR,HU,IE,IS,IT,LI,LT,LU,LV,ME,MK,MT,NL,NO,PL,PT,RO,RS,SE,SI,SK,TR,UK)
```

```{r}
newenergydata <-read.csv("newenergydata.csv",check.names=FALSE)
```


```{r}

Germany <- subset(newenergydata, Country == "DE") 
Germany$Date <- NULL

ggpairs(Germany,diag = list(continuous="barDiag"))+
  theme(text = element_text(size = 6),panel.spacing = unit(0.1, "lines"))
```

```{r}
#precipitation hydropower runoff   
ggplot(Germany) +
  geom_point(aes(x = `TP [m]`, 
                 y= `HRO [W]`,
                 col = Country), alpha = 0.5)+
  labs(x = "TP", y = "HRO") + 
  theme_bw()+
  theme(axis.text.x = element_text(angle=90, vjust=.5, hjust=1))
```

```{r}
#windpower generation wind speed   
ggplot(Germany) +
  geom_point(aes(x = `WS-10m [ms-1]`, 
                 y= `WON [MW/MW]`,
                 col = Country), alpha = 0.5)+
  labs(x = "WS-10m", y = "WON") + 
  theme_bw()+
  theme(axis.text.x = element_text(angle=90, vjust=.5, hjust=1))
```

```{r}
#irradiance solar power  
ggplot(Germany) +
  geom_point(aes(x = Germany$`GHI [Wm-2]`, 
                 y= Germany$`SPV [MW/MW]`,
                 col = Country), alpha = 0.5)+
  labs(y = "SPV", x = "GHI") + 
  theme_bw()+
  theme(axis.text.x = element_text(angle=90, vjust=.5, hjust=1))
```

```{r}
#precipitation solar power   
ggplot(Germany) +
  geom_point(aes(x = `TP [m]`, 
                 y= `SPV [MW/MW]`,
                 col = Country), alpha = 0.5)+
  labs(x = "TP", y = "SPV") + 
  theme_bw()+
  theme(axis.text.x = element_text(angle=90, vjust=.5, hjust=1))
```

```{r}
#irradiance temperature 
ggplot(Germany) +
  geom_point(aes(x = `GHI [Wm-2]`, 
                 y= `TA [K]`,
                 col = Country), alpha = 0.5)+
  labs(x = "GHI", y = "TA") + 
  theme_bw()+
  theme(axis.text.x = element_text(angle=90, vjust=.5, hjust=1))
```

```{r}
#irradiance precipitation 
ggplot(Germany) +
  geom_point(aes(x =`GHI [Wm-2]` , 
                 y= `TP [m]`,
                 col = Country), alpha = 0.5)+
  labs(x = "GHI", y = "TP") + 
  theme_bw()+
  theme(axis.text.x = element_text(angle=90, vjust=.5, hjust=1))
```

### Methods 1: Applications of the linear model (20 points)

```{r}

mod <- glm(`GHI [Wm-2]`~ `SPV [MW/MW]` , data=Germany)
```

```{r}
intercept <- round(coef(mod)[1],digits=2)
slope <- round(coef(mod)[2],digits=8)

label1 <- print(paste0("y = ",slope," x + ",intercept))
  
```

```{r}
#irradiance solar power  
germanyplot = ggplot(Germany,aes(x = `GHI [Wm-2]`, 
                 y= `SPV [MW/MW]`,
                 col=Country)) +
  geom_point(alpha = 0.8,col="darkorchid")+
  geom_smooth(method = "glm", 
              formula = y ~ x, 
              aes(col = "Germany"),
              fill="darkorchid") +
  scale_colour_manual(name="Country", values="darkorchid")+
  annotate("text", x = 115, y = 49999999, label = label1, col = "darkorchid")+
  labs(y = "Solar photovoltaic power generation [MW/MW]", x = "Surface downwelling shortwave radiation [Wm-2]") + 
  theme_bw()+
  theme(axis.text.y = element_text(angle=90, vjust=.5, hjust=1),legend.position = "top")


```
```{r}

Norway <- subset(newenergydata, Country == "NO") 

modNO <- glm(`GHI [Wm-2]`~ `SPV [MW/MW]` , data=Norway)

intercept <- round(coef(modNO)[1],digits=2)
slope <- round(coef(modNO)[2],digits=8)

label2 <- print(paste0("y = ",slope," x + ",intercept))

#irradiance solar power Norway
norwayplot = ggplot(Norway,aes(x = `GHI [Wm-2]`, 
                 y= `SPV [MW/MW]`,
                 col="")) +
  geom_point(alpha = 0.8,col="blue")+
  geom_smooth(method = "glm", 
              formula = y ~ x, 
              aes(col = "Norway"),
              fill="blue") +
  scale_colour_manual(name="", values="blue")+
  annotate("text", x = 89, y = 580000 , label = label2, col = "blue")+
  labs(y = "Solar photovoltaic power generation [MW/MW]", x = "Surface downwelling shortwave radiation [Wm-2]") + 
  theme_bw()+
  theme(axis.text.y = element_text(angle=90, vjust=.5, hjust=1),legend.position = "top")


```

```{r}

Spain <- subset(newenergydata,Country =="ES")

modES <- glm(`GHI [Wm-2]`~ `SPV [MW/MW]` , data=Spain)

intercept <- round(coef(modES)[1],digits=2)
slope <- round(coef(modES)[2],digits=8)

label3 <- print(paste0("y = ",slope," x + ",intercept))

#irradiance solar power Spain
spainplot = ggplot(Spain,aes(x = `GHI [Wm-2]`, 
                 y= `SPV [MW/MW]`,
                 col="")) +
  geom_point(alpha = 0.8,col="orange")+
  geom_smooth(method = "glm", 
              formula = y ~ x, 
              aes(col = "Spain"),
              fill="orange") +
  scale_colour_manual(name="", values="orange")+
  annotate("text", x = 185, y = 7010000 , label = label3, col = "orange")+
  labs(y = "Solar photovoltaic power generation [MW/MW]", x = "Surface downwelling shortwave radiation [Wm-2]") + 
  theme_bw()+
  theme(axis.text.y = element_text(angle=90, vjust=.5, hjust=1),legend.position = "top")


```

```{r}
ggarrange(germanyplot+
              theme(axis.ticks.x = element_blank(),
                  axis.title.x = element_blank()),
          norwayplot+
              theme(axis.ticks.y = element_blank(),
                    axis.title.y = element_blank()),
          spainplot+
            theme(axis.ticks.x = element_blank(),
                  axis.title.x = element_blank(), 
                  axis.ticks.y = element_blank(),
                  axis.title.y = element_blank() ),
          nrow=1)




```
### Methods 2: Applications of tree-based models (20 points)

### Methods 3: Application of statistical testing (10 points)

### Methods 4: Application of XXX (15 points)

### Discussion and Conclusions (15 points)

-   What did you learn from your data analysis?
-   How could this be improved?
-   etc.
